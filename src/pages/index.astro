---
export const prerender = false;

import Layout from "../layouts/Layout.astro";
import Table from "../components/scoreboard/Table.astro";
import data from "../data/players.json";
import BASE_URL, { endpoints } from "../data/endpoints"
import getAuthToken from "../scritps/getAuthToken"

const LEAGUE_ID = "013805954";
const TEAM_ID = "17193364"

async function fetchRanking(token: string | null) {
    if (token !== null && !import.meta.env.PROD) {
        try {
            const response = await fetch(`${BASE_URL}${endpoints.leagueRanking(LEAGUE_ID)}`, {
                headers: {
                    Authorization: `Bearer ${token}`,
                    "Content-Type": "application/json",
                },
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const responseData = await response.json();
            return responseData.players || responseData;
        } catch (error) {
            console.error("Failed to fetch players data:", error);
            return data.players;
        }
    } else return [data.players[0]]
}

let AUTH_TOKEN: string | null = await getAuthToken();
const players: Player[] = await fetchRanking(AUTH_TOKEN);
---

<Layout currentPage="index">
    <Table players={players} />
</Layout>
